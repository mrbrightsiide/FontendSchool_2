<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ColaCola</title>
    <link rel="stylesheet" href="./src/style/reset.css" />
    <link rel="stylesheet" href="./src/style/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="app">
      <h1 class="tit-app ir">cola cola</h1>
      <section class="vending-machine">
        <h2 class="ir">자판기 화면</h2>
        <ul class="list-item"></ul>

        <section class="cont-buy">
          <h2 class="ir">구입 관련 정보</h2>
          <div class="info-balance">
            잔액 :
            <span class="txt-balance">원</span>
          </div>
          <button type="button" class="btn-return">거스름돈 반환</button>

          <input
            class="inp-put"
            type="number"
            placeholder="입금액 입력"
            min="0"
          />
          <button type="button" class="btn-put">입금</button>

          <strong class="ir">선택한 음료</strong>
          <ul class="list-item-staged"></ul>
          <button class="btn-get" type="button">획득</button>
        </section>
      </section>
      <section class="my-info">
        <h2 class="ir">나의 정보 화면</h2>
        <div class="cont-mymoney">
          <div class="info-mymoney">
            소지금 :
            <span class="txt-mymoney"></span>
          </div>
        </div>
        <div class="cont-myitems">
          <strong class="tit-myitem">획득한 음료</strong>
          <ul class="list-item-staged">
            <li>
              <button type="button" class="btn-staged">
                <img src="./src/images/Cool_Cola.png" alt="" class="img-item" />
                <strong class="txt-item">Original Cola</strong>
                <span class="num-counter">1</span>
              </button>
            </li>
          </ul>
          <strong class="txt-total">총금액 : 0원</strong>
        </div>
      </section>
    </div>
    <script>
      // 콜라 데이터 받아오기
      const getColaData = async () => {
        const response = await fetch(
          `https://mrbrightsiide.github.io/FontendSchool_2/vending-machine/data.json`
        );
        if (response.ok === true) {
          const colas = await response.json();
          for (let i = 0; i < colas.length; i++) {
            colaList.innerHTML += `<li><button type="button" class="btn-item"><img src=${colas[i].img} alt="" class="img-item"/><strong class="tit-item">${colas[i].name}</strong><span class="txt-price">${colas[i].price}</button></li>`;
          }
        } else {
          return alert("Sorry, We can't get our Colas :(");
        }
      };
      getColaData();

      let totalBudget = 30000;
      let colaTotal = 0;
      let balance = 0;
      const colaList = document.querySelector(".list-item");
      const itemStaged = document.querySelector(".list-item-staged");
      const txtMyMoney = document.querySelector(".txt-mymoney");
      const txtbalance = document.querySelector(".txt-balance");
      const depositPutBtn = document.querySelector(".btn-put");
      const depositInput = document.querySelector(".inp-put");

      // 소지금 초기화
      txtMyMoney.textContent = totalBudget;

      //입금 버튼 클릭
      depositPutBtn.addEventListener("click", () => {
        const deposit = depositInput.value;
        if (!deposit) {
          return alert("입금액을 입력해주세요");
        }
        if (totalBudget > deposit && deposit >= 0) {
          totalBudget -= parseInt(deposit);
          balance += parseInt(deposit);
          txtbalance.textContent = balance;
          txtMyMoney.textContent = totalBudget;
          return (depositInput.value = "");
        }
        if (deposit < 0 || deposit === NaN) {
          return alert("유효한 금액을 입력해주세요");
        }
        if (totalBudget < deposit) {
          return alert("소지금이 모자랍니다 :(");
        }
      });

      // 콜라 버튼 클릭
      colaList.addEventListener("click", (event) => {
        const itemImg =
          event.target.childNodes[0].childNodes[0].getAttribute("src");
        const itemTxt = event.target.childNodes[0].childNodes[1].textContent;
        const itemPrice = parseInt(
          event.target.childNodes[0].childNodes[2].textContent
        );
        if (balance < itemPrice) {
          return alert("잔액이 모자랍니다 :(");
        }
        if (balance >= itemPrice && balance >= 0) {
          itemStaged.innerHTML += `<li><button type="button" class="btn-staged"><img src=${itemImg} alt="" class="img-item" /><strong class="txt-item">${itemTxt}</strong><span class="num-counter">${1}</span></button></li>`;
          balance -= itemPrice;
          colaTotal += itemPrice;
          return (txtbalance.textContent = balance);
        }
      });
    </script>
  </body>
</html>
